<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Professional expense tracking PWA for owner-operator truck drivers. Track fuel, maintenance, meals, and all business expenses with receipt management and tax insights.">
    <meta name="keywords" content="trucker expenses, owner operator, truck driver, expense tracker, tax deductions, fuel tracking, maintenance records">
    <meta name="author" content="Trucker Expense Tracker">
    <meta name="robots" content="index, follow">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://trucker-expense-tracker.vercel.app/">
    <meta property="og:title" content="Trucker Expense Tracker - Professional Expense Management">
    <meta property="og:description" content="Track your trucking expenses professionally with our PWA designed for owner-operators.">
    <meta property="og:image" content="https://trucker-expense-tracker.vercel.app/icon-512x512.png">

    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://trucker-expense-tracker.vercel.app/">
    <meta property="twitter:title" content="Trucker Expense Tracker - Professional Expense Management">
    <meta property="twitter:description" content="Track your trucking expenses professionally with our PWA designed for owner-operators.">
    <meta property="twitter:image" content="https://trucker-expense-tracker.vercel.app/icon-512x512.png">

    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: blob:; connect-src 'self';">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin">

    <title>Trucker Expense Tracker - Professional Expense Management for Owner-Operators</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="32x32" href="icon-72x72.png">
    <link rel="icon" type="image/png" sizes="96x96" href="icon-96x96.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192x192.png">
    <link rel="apple-touch-icon" sizes="72x72" href="icon-72x72.png">
    <link rel="apple-touch-icon" sizes="96x96" href="icon-96x96.png">
    <link rel="apple-touch-icon" sizes="144x144" href="icon-144x144.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192x192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512x512.png">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Trucker Expense Tracker">

    <style>
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1e40af;
            --secondary-color: #10b981;
            --background-light: #f8fafc;
            --background-dark: #0f172a;
            --text-light: #1e293b;
            --text-dark: #f1f5f9;
            --card-light: #ffffff;
            --card-dark: #1e293b;
            --border-light: #e2e8f0;
            --border-dark: #334155;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --info-color: #3b82f6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: var(--text-light);
            min-height: 100vh;
            padding-bottom: 120px;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }

        body.dark-mode {
            background: linear-gradient(135deg, var(--background-dark), #0c1426);
            color: var(--text-dark);
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: calc(100vh - 120px);
            box-sizing: border-box;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            padding-top: 50px;
            /* CLS Fix: Reserve a stable height for the entire header block */
            min-height: 220px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .header-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
            z-index: 10;
        }

        .version-display {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .dark-mode-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .header h1 {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header .subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
            font-weight: 300;
        }

        .trial-countdown {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            margin-top: 15px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
            align-self: center; /* Center within the flex header */
        }
        
        /* Other styles for summary-card, action-buttons etc. remain below */
        .summary-card {
            background: linear-gradient(135deg, #047857, #059669);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin: 25px 0;
            text-align: left;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            overflow: hidden;
        }

        .summary-card h3 {
            margin-bottom: 20px;
            font-size: 1.3rem;
            text-align: center;
        }

        .summary-item {
            display: grid;
            grid-template-columns: 1fr auto;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 0.95rem;
            gap: 15px;
            line-height: 1.3;
        }

        .summary-item:last-child {
            border-bottom: none;
            font-size: 1.1rem;
            font-weight: 700;
            padding-top: 15px;
        }

        .summary-item span:first-child {
            font-weight: 500;
            word-wrap: break-word;
        }

        .summary-item span:last-child {
            font-weight: 600;
            text-align: right;
            white-space: nowrap;
        }
        
        .summary-value {
            min-width: 90px;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 25px 20px;
            max-width: calc(100% - 40px);
            box-sizing: border-box;
        }

        .action-btn {
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
            border: 2px solid var(--border-light);
            border-radius: 12px;
            padding: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: var(--text-light);
            height: 80px;
        }

        @media (max-width: 768px) {
            .header {
                min-height: 0; /* On mobile, we don't need the fixed height */
                padding-top: 20px;
                padding-bottom: 20px;
            }
            .header-controls {
                position: relative;
                top: 0;
                right: 0;
                justify-content: center;
                margin-bottom: 15px;
                gap: 15px;
            }
            .action-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
            .action-btn {
                height: 70px;
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <div class="container">
        <header class="header">
            <div class="header-controls">
                <button class="dark-mode-toggle" onclick="toggleDarkMode()" aria-label="Toggle dark mode">üåô</button>
                <div class="version-display">v2.1.0</div>
            </div>
            <h1>üöõ Trucker Expense Tracker</h1>
            <p class="subtitle">Professional expense management for owner-operators</p>
            <div id="trialCountdown" class="trial-countdown">
                <span id="trialText">üéÅ Free Trial: <span id="daysLeft">30</span> days remaining</span>
            </div>
        </header>

        <main id="main-content">
            <section id="todaySection" class="section">
                <h2>üìÖ Log your expenses for today</h2>
                <div class="expense-grid" id="expenseGrid" aria-label="Expense categories"></div>
                <div class="summary-card">
                    <h3>üìä Today's Summary</h3>
                    <div class="summary-item">
                        <span>Total Daily Expenses:</span>
                        <span id="dailyTotal" class="summary-value">$0.00</span>
                    </div>
                    <div class="summary-item">
                        <span>Total Expenses:</span>
                        <span id="totalExpenses" class="summary-value">$0.00</span>
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="action-btn export-btn" onclick="exportToPDF()">üìÑ Export PDF</button>
                    <button class="action-btn print-btn" onclick="printSection()">üñ®Ô∏è Print</button>
                    <button class="action-btn csv-btn" onclick="exportToCSV()">üìä Export CSV</button>
                    <button class="action-btn feedback-btn" onclick="showFeedback()">üí¨ Feedback</button>
                    <button class="action-btn faq-btn" onclick="showFAQ()">‚ùì FAQ</button>
                    <button class="action-btn update-btn" onclick="checkForUpdates()">üîÑ Check for Updates</button>
                    <button class="action-btn" style="background: #8b5cf6;" onclick="backupData()">üíæ Backup Data</button>
                    <button class="action-btn" style="background: #06b6d4;" onclick="restoreData()">üì• Restore Data</button>
                    <button class="action-btn subscribe-btn" onclick="window.open('https://buy.stripe.com/28EeVc2X1d4V3XleCBdZ600', '_blank')">üí≥ Subscribe - $9.99/mo</button>
                </div>
            </section>
            
            </main>
    </div>

    <script>
        // All JavaScript remains the same as the previous version.
        const expenseCategories=[{id:"fuel",name:"Fuel",icon:"‚õΩ"},{id:"maintenance",name:"Maintenance & Repairs",icon:"üîß"},{id:"meals",name:"Meals",icon:"üçΩÔ∏è"},{id:"lodging",name:"Lodging",icon:"üè®"},{id:"tolls",name:"Tolls & Parking",icon:"üõ£Ô∏è"},{id:"permits",name:"Permits & Licenses",icon:"üìã"},{id:"insurance",name:"Insurance",icon:"üõ°Ô∏è"},{id:"phone",name:"Phone & Communication",icon:"üì±"},{id:"supplies",name:"Supplies & Equipment",icon:"üì¶"},{id:"training",name:"Training & Education",icon:"üìö"},{id:"medical",name:"Medical & DOT Exams",icon:"üè•"},{id:"office",name:"Office Expenses",icon:"üè¢"},{id:"bank",name:"Bank & Financial Fees",icon:"üè¶"},{id:"legal",name:"Legal & Professional",icon:"‚öñÔ∏è"},{id:"other",name:"Other Business Expenses",icon:"üíº"}];let expenses=JSON.parse(localStorage.getItem("truckerExpenses")||"[]"),isDarkMode="true"===localStorage.getItem("darkMode"),currentSection="today",trialStartDate=localStorage.getItem("trialStartDate")||Date.now(),isTrialExpired=!1;localStorage.getItem("trialStartDate")||localStorage.setItem("trialStartDate",trialStartDate),document.addEventListener("DOMContentLoaded",function(){const e=new URLSearchParams(window.location.search);if("trial"===e.get("reset"))return localStorage.removeItem("trialStartDate"),localStorage.removeItem("truckerExpenses"),localStorage.removeItem("darkMode"),trialStartDate=Date.now(),localStorage.setItem("trialStartDate",trialStartDate),expenses=[],alert("Trial has been reset! Redirecting..."),void(window.location.href=window.location.pathname);initializeApp(),updateTrialCountdown(),populateExpenseGrid(),updateToggleIcon(),updateSummary(),updateInsights(),"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js").then(e=>console.log("SW registered")).catch(e=>console.log("SW registration failed"))});function initializeApp(){if(isDarkMode&&(document.body.classList.add("dark-mode"),document.querySelector(".dark-mode-toggle").textContent="‚òÄÔ∏è"),"add-fuel"===(new URLSearchParams(window.location.search)).get("action"))showSection("today"),setTimeout(()=>toggleExpenseCard("fuel"),500);else if("history"===(new URLSearchParams(window.location.search)).get("action"))showSection("history");else if("export"===(new URLSearchParams(window.location.search)).get("action"))exportToPDF()}function updateTrialCountdown(){const e=30*24*60*60*1e3,t=Date.now()-parseInt(trialStartDate),o=Math.max(0,Math.ceil((e-t)/(864e5))),n=document.getElementById("trialCountdown"),a=document.getElementById("trialText");o<=0?(isTrialExpired=!0,n.className="trial-countdown expired",a.innerHTML="‚ö†Ô∏è Trial Expired - Subscribe to continue using"):o<=7?(n.className="trial-countdown warning",a.innerHTML=`üéÅ Free Trial: <span id="daysLeft">${o}</span> days remaining`):(n.className="trial-countdown",a.innerHTML=`üéÅ Free Trial: <span id="daysLeft">${o}</span> days remaining`)}function populateExpenseGrid(){const e=document.getElementById("expenseGrid");e.innerHTML="",expenseCategories.forEach(t=>{const o=document.createElement("div");o.className="expense-card",o.id=`card-${t.id}`,o.setAttribute("role","button"),o.setAttribute("tabindex","0"),o.setAttribute("aria-label",`Add ${t.name} expense`),o.innerHTML=`
                    <div class="expense-header">
                        <div class="expense-icon">${t.icon}</div>
                        <div class="expense-title">${t.name}</div>
                    </div>
                    <div class="expense-form" id="form-${t.id}">
                        <form onsubmit="addExpense(event, '${t.id}')">
                            <div class="form-group">
                                <label for="amount-${t.id}">Amount ($):</label>
                                <input type="number" id="amount-${t.id}" step="0.01" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="description-${t.id}">Description:</label>
                                <input type="text" id="description-${t.id}" placeholder="Enter expense details...">
                            </div>
                            <div class="form-group">
                                <label for="location-${t.id}">Location:</label>
                                <input type="text" id="location-${t.id}" placeholder="City, State">
                            </div>
                            <div class="form-group">
                                <label for="receipt-${t.id}">Receipt (optional):</label>
                                <input type="file" id="receipt-${t.id}" accept="image/*" onchange="previewReceipt('${t.id}')">
                                <div id="receipt-preview-container-${t.id}"></div>
                            </div>
                            <div style="display: flex; gap: 10px; margin-top: 15px;">
                                <button type="submit" class="btn">Add Expense</button>
                                <button type="button" class="btn btn-secondary" onclick="toggleExpenseCard('${t.id}')">Cancel</button>
                            </div>
                        </form>
                    </div>
                `,o.addEventListener("click",e=>{e.target.closest(".expense-form")||toggleExpenseCard(t.id)}),o.addEventListener("keydown",e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),o.classList.contains("expanded")||toggleExpenseCard(t.id))}),e.appendChild(o)})}function toggleExpenseCard(e){if(isTrialExpired)return void alert("Your trial has expired. Please subscribe to continue adding expenses.");const t=document.getElementById(`card-${e}`),o=document.getElementById(`form-${e}`),n=document.querySelectorAll(".expense-card");if(t.classList.contains("expanded"))return t.classList.remove("expanded"),void o.classList.remove("active");n.forEach(e=>{e.classList.remove("expanded");const t=e.querySelector(".expense-form");t&&t.classList.remove("active")}),t.classList.add("expanded"),o.classList.add("active"),setTimeout(()=>{document.getElementById(`amount-${e}`).focus()},100)}function addExpense(e,t){e.preventDefault();if(isTrialExpired)return void alert("Your trial has expired. Please subscribe to continue adding expenses.");const o=document.getElementById(`amount-${t}`),n=parseFloat(o.value);if(isNaN(n)||n<=0)return showNotification("Please enter a valid amount greater than $0.00","error"),void o.focus();if(n>999999)return showNotification("Amount cannot exceed $999,999.00","error"),void o.focus();const a=document.getElementById(`description-${t}`).value.trim(),i=document.getElementById(`location-${t}`).value.trim(),d=document.getElementById(`receipt-${t}`).files[0];if(d&&d.size>5242880)return void showNotification("Receipt file must be smaller than 5MB","error");const c=expenseCategories.find(e=>e.id===t),l={id:Date.now()+Math.random(),categoryId:t,categoryName:c.name,icon:c.icon,amount:n,description:a,location:i,date:(new Date).toISOString(),receipt:null};if(d){const s=new FileReader;s.onload=function(e){l.receipt=e.target.result,r(l)},s.readAsDataURL(d)}else r(l);function r(o){expenses.push(o),localStorage.setItem("truckerExpenses",JSON.stringify(expenses)),e.target.reset(),document.getElementById(`receipt-preview-container-${t}`).innerHTML="",toggleExpenseCard(t),updateSummary(),updateInsights(),updateHistory(),showNotification(`${c.name} expense added successfully!`,"success")}}function previewReceipt(e){const t=document.getElementById(`receipt-${e}`),o=document.getElementById(`receipt-preview-container-${e}`);t.files&&t.files[0]?(reader=new FileReader,reader.onload=function(e){o.innerHTML=`<img src="${e.target.result}" class="receipt-preview" alt="Receipt preview">`},reader.readAsDataURL(t.files[0])):o.innerHTML=""}function updateSummary(){const e=(new Date).toDateString(),t=expenses.filter(t=>(new Date(t.date)).toDateString()===e),o=t.reduce((e,t)=>e+t.amount,0),n=expenses.reduce((e,t)=>e+t.amount,0);document.getElementById("dailyTotal").textContent=`$${o.toFixed(2)}`,document.getElementById("totalExpenses").textContent=`$${n.toFixed(2)}`}function updateInsights(){const e=expenses.reduce((e,t)=>e+t.amount,0),t=[...new Set(expenses.map(e=>(new Date(e.date)).toDateString()))].length,o=t>0?e/t:0,n={};expenses.forEach(e=>{n[e.categoryName]=(n[e.categoryName]||0)+e.amount});const a=Object.keys(n).reduce((e,t)=>n[e]>n[t]?e:t,"None"),i=new Date,d=i.getMonth(),c=i.getFullYear(),l=0===d?11:d-1,s=0===d?c-1:c,r=expenses.filter(e=>{const t=new Date(e.date);return t.getMonth()===d&&t.getFullYear()===c}).reduce((e,t)=>e+t.amount,0),p=expenses.filter(e=>{const t=new Date(e.date);return t.getMonth()===l&&t.getFullYear()===s}).reduce((e,t)=>e+t.amount,0),u=p>0?((r-p)/p*100).toFixed(1):r>0?"‚àû":"0";document.getElementById("insightsTotalExpenses").textContent=`$${e.toFixed(2)}`,document.getElementById("averageDailyExpense").textContent=`$${o.toFixed(2)}`,document.getElementById("topCategory").textContent=a,document.getElementById("currentMonthTotal").textContent=`$${r.toFixed(2)}`,document.getElementById("lastMonthTotal").textContent=`$${p.toFixed(2)}`;const m=document.getElementById("monthlyChange");if("‚àû"===u)m.textContent="New spending",m.style.color="#fbbf24";else if("0"===u)m.textContent="No change",m.style.color="#6b7280";else{const g=parseFloat(u);m.textContent=`${g>0?"+":""}${g}%`,m.style.color=g>0?"#ef4444":"#10b981"}updateCategoryBreakdown(n),updateMonthlyBreakdown()}function updateCategoryBreakdown(e){const t=document.getElementById("categoryList");if(0===Object.keys(e).length)return void(t.innerHTML='<p class="no-data-message">No expense data available for analysis.</p>');const o=Object.entries(e).sort((([,e],[,t])=>t-e)).slice(0,10),n=Object.values(e).reduce(((e,t)=>e+t),0);t.innerHTML=o.map((([t,o])=>{const a=((o/n)*100).toFixed(1),i=expenseCategories.find(e=>e.name===t),d=i?i.icon:"üíº";return`
                    <li>
                        <div class="summary-item" style="padding: 15px 0; border-bottom: 1px solid var(--border-light); align-items: flex-start; gap: 10px;">
                            <span style="display: flex; align-items: center; gap: 8px; color: var(--text-light); flex: 1; min-width: 0;">
                                <span style="font-size: 1.2rem; flex-shrink: 0;">${d}</span>
                                <span style="word-wrap: break-word; overflow-wrap: break-word; font-size: 1rem; line-height: 1.3;">${t}</span>
                            </span>
                            <span style="text-align: right; flex-shrink: 0; min-width: 80px;">
                                <div style="font-weight: 600; color: var(--primary-color); font-size: 1rem;">$${o.toFixed(2)}</div>
                                <div style="font-size: 0.85rem; color: var(--text-light); opacity: 0.8;">${a}%</div>
                            </span>
                        </div>
                    </li>
                `})).join("")}function updateMonthlyBreakdown(){const e=document.getElementById("monthlyBreakdown");if(0===expenses.length)return void(e.innerHTML='<p class="no-data-message">No expense data available for monthly analysis.</p>');const t={};expenses.forEach(e=>{const o=new Date(e.date),n=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}`,a=o.toLocaleDateString("en-US",{year:"numeric",month:"long"});t[n]||(t[n]={name:a,total:0,count:0}),t[n].total+=e.amount,t[n].count+=1});const o=Object.entries(t).sort((([e],[t])=>t.localeCompare(e))).slice(0,6);e.innerHTML=o.map((([e,t])=>{const o=t.total/t.count;return`
                    <li>
                        <div class="summary-item" style="padding: 15px 0; border-bottom: 1px solid var(--border-light); align-items: flex-start; gap: 10px;">
                            <span style="display: flex; align-items: center; gap: 8px; color: var(--text-light); flex: 1; min-width: 0;">
                                <span style="font-size: 1.2rem; flex-shrink: 0;">üìÖ</span>
                                <span style="word-wrap: break-word; overflow-wrap: break-word; font-size: 1rem; line-height: 1.3;">${t.name}</span>
                            </span>
                            <span style="text-align: right; flex-shrink: 0; min-width: 90px;">
                                <div style="font-weight: 600; color: var(--primary-color); font-size: 1rem;">$${t.total.toFixed(2)}</div>
                                <div style="font-size: 0.85rem; color: var(--text-light); opacity: 0.8; line-height: 1.3;">${t.count} trans ‚Ä¢ $${o.toFixed(2)} avg</div>
                            </span>
                        </div>
                    </li>
                `})).join("")}function updateHistory(){const e=document.getElementById("historyList"),t=document.getElementById("dateFilter"),o=t?t.value:"all";let n=[...expenses];const a=new Date;switch(o){case"today":n=expenses.filter(e=>(new Date(e.date)).toDateString()===a.toDateString());break;case"week":const i=new Date(a.getTime()-6048e5);n=expenses.filter(e=>new Date(e.date)>=i);break;case"month":n=expenses.filter(e=>(new Date(e.date)).getMonth()===a.getMonth()&&(new Date(e.date)).getFullYear()===a.getFullYear());break;case"year":n=expenses.filter(e=>(new Date(e.date)).getFullYear()===a.getFullYear());break}if(0===n.length)return void(e.innerHTML='<p class="no-data-message">No expenses found for the selected period.</p>');n.sort(((e,t)=>new Date(t.date)-new Date(e.date))),e.innerHTML=n.map(e=>`
                <li><div class="expense-card" style="margin-bottom: 15px;">
                    <div class="expense-header">
                        <div class="expense-icon">${e.icon}</div>
                        <div style="flex: 1;">
                            <div class="expense-title" style="color: var(--text-light); font-weight: 600;">${e.categoryName}</div>
                            <div class="expense-subtitle" style="color: var(--text-light); opacity: 0.7; font-size: 0.9rem;">
                                ${(new Date(e.date)).toLocaleDateString()} ${e.location?`‚Ä¢ ${e.location}`:""}
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div class="expense-amount" style="color: var(--primary-color); font-size: 1.2rem; font-weight: 600;">$${e.amount.toFixed(2)}</div>
                        </div>
                    </div>
                    ${e.description?`<div class="expense-description" style="margin-top: 10px; color: var(--text-light); opacity: 0.8;">${e.description}</div>`:""}
                    ${e.receipt?`<div style="margin-top: 10px;"><img src="${e.receipt}" class="receipt-preview" alt="Receipt"></div>`:""}
                    <button onclick="deleteExpense('${e.id}')" class="btn-delete">Delete</button>
                </div></li>
            `).join("")}function deleteExpense(e){confirm("Are you sure you want to delete this expense?")&&(expenses=expenses.filter(t=>t.id!=e),localStorage.setItem("truckerExpenses",JSON.stringify(expenses)),updateSummary(),updateInsights(),updateHistory(),showNotification("Expense deleted successfully!","success"))}function filterExpenses(){updateHistory()}function showSection(e){document.querySelectorAll(".section").forEach(e=>{e.classList.add("hidden")}),document.getElementById(`${e}Section`).classList.remove("hidden"),document.querySelectorAll(".nav-btn").forEach(t=>{t.classList.remove("active")}),document.querySelector(`[data-section="${e}"]`).classList.add("active"),currentSection=e,"history"===e?updateHistory():"insights"===e&&updateInsights()}function showNotification(e,t="info"){const o=document.createElement("div");o.style.cssText=`
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${"success"===t?"var(--success-color)":"var(--info-color)"};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                z-index: 3000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                font-weight: 600;
                transform: translateX(100%);
                transition: transform 0.3s ease;
            `,o.textContent=e,document.body.appendChild(o),setTimeout(()=>{o.style.transform="translateX(0)"},100),setTimeout(()=>{o.style.transform="translateX(100%)",setTimeout(()=>{document.body.removeChild(o)},300)},3e3)}function exportToPDF(){window.print()}function printSection(){window.print()}function exportToCSV(){if(0===expenses.length)return void alert("No expenses to export.");const e=["Date","Category","Amount","Description","Location"],t=[e.join(","),...expenses.map(e=>[(new Date(e.date)).toLocaleDateString(),e.categoryName,e.amount,`"${e.description||""}"`,`"${e.location||""}"`].join(","))].join("\n"),o=new Blob([t],{type:"text/csv"}),n=window.URL.createObjectURL(o),a=document.createElement("a");a.href=n,a.download=`trucker-expenses-${(new Date).toISOString().split("T")[0]}.csv`,a.click(),window.URL.revokeObjectURL(n)}function exportHistoryToPDF(){showSection("history"),setTimeout(()=>window.print(),500)}function printHistory(){showSection("history"),setTimeout(()=>window.print(),500)}function exportHistoryToCSV(){exportToCSV()}function exportInsightsToPDF(){showSection("insights"),setTimeout(()=>window.print(),500)}function printInsights(){showSection("insights"),setTimeout(()=>window.print(),500)}function exportInsightsToCSV(){exportToCSV()}function updateFAQWithTrialDate(){const e=document.getElementById("trial-start-date-display");if(e){const t=localStorage.getItem("trialStartDate");t?e.textContent=(new Date(parseInt(t))).toLocaleString():e.textContent="Not started yet."}}function showFAQ(){document.getElementById("faqModal").classList.add("active"),updateFAQWithTrialDate()}function closeFAQ(){document.getElementById("faqModal").classList.remove("active")}function toggleFAQ(e){const t=e.nextElementSibling,o=e.querySelector("span");t.classList.toggle("active"),o.textContent=t.classList.contains("active")?"-":"+"}function showFeedback(){document.getElementById("feedbackModal").classList.add("active")}function closeFeedback(){document.getElementById("feedbackModal").classList.remove("active"),setTimeout(()=>{resetFeedbackForm()},300)}function updateEmailDisplay(){const e=document.getElementById("feedbackType").value,t=document.getElementById("emailDisplay");"feature"===e?(t.textContent="üìß Will be sent to: features@truckerexpensetracker.com",t.style.color="#10b981"):e?(t.textContent="üìß Will be sent to: support@truckerexpensetracker.com",t.style.color="#10b981"):t.textContent=""}function submitFeedback(e){e.preventDefault();const t=document.getElementById("feedbackSubmitBtn"),o=document.getElementById("feedbackForm"),n=document.getElementById("feedbackSuccess");t.textContent="Sending...",t.disabled=!0,t.style.background="#6b7280";const a=document.getElementById("feedbackType").value,i=document.getElementById("feedbackMessage").value,d=document.getElementById("feedbackEmail").value;let c="support@truckerexpensetracker.com";"feature"===a&&(c="features@truckerexpensetracker.com");const l=`Trucker Expense Tracker - ${a.charAt(0).toUpperCase()+a.slice(1)} ${"bug"===a?"Report":"feature"===a?"Request":"Feedback"}`,s=`Feedback Type: ${a}\n\nMessage:\n${i}\n\n${d?`Reply to: ${d}\n\n`:""}Sent from Trucker Expense Tracker PWA`,r=`mailto:${c}?subject=${encodeURIComponent(l)}&body=${encodeURIComponent(s)}`;setTimeout(()=>{o.style.display="none",n.style.display="block",window.location.href=r,showNotification("Your email client should open shortly...","success")},1e3)}function resetFeedbackForm(){const e=document.getElementById("feedbackForm"),t=document.getElementById("feedbackSuccess"),o=document.getElementById("feedbackSubmitBtn");e.style.display="block",t.style.display="none",e.reset(),document.getElementById("emailDisplay").textContent="",o.textContent="Send Feedback",o.disabled=!1,o.style.background=""}function checkForUpdates(){showNotification("You are using the latest version (v2.1.0)","success")}function backupData(){try{const e={expenses:expenses,trialStartDate:localStorage.getItem("trialStartDate"),darkMode:localStorage.getItem("darkMode"),version:"2.1.0",timestamp:(new Date).toISOString()},t=JSON.stringify(e,null,2),o=new Blob([t],{type:"application/json"}),n=URL.createObjectURL(o),a=document.createElement("a");a.href=n,a.download=`trucker-expenses-backup-${(new Date).toISOString().split("T")[0]}.json`,a.click(),URL.revokeObjectURL(n),showNotification("Data backup downloaded successfully!","success")}catch(e){showNotification("Failed to create backup. Please try again.","error"),console.error("Backup error:",e)}}function restoreData(){const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=function(t){const o=t.target.files[0];if(o){const n=new FileReader;n.onload=function(t){try{const o=JSON.parse(t.target.result);if(confirm("This will replace all current data. Are you sure you want to restore from backup?")){o.expenses&&Array.isArray(o.expenses)&&(expenses=o.expenses,localStorage.setItem("truckerExpenses",JSON.stringify(expenses))),o.trialStartDate&&(localStorage.setItem("trialStartDate",o.trialStartDate),trialStartDate=o.trialStartDate),o.darkMode&&(localStorage.setItem("darkMode",o.darkMode),isDarkMode="true"===o.darkMode,isDarkMode&&(document.body.classList.add("dark-mode"),document.querySelector(".dark-mode-toggle").textContent="‚òÄÔ∏è")),updateSummary(),updateInsights(),updateHistory(),updateTrialCountdown(),showNotification("Data restored successfully!","success")}}catch(e){showNotification("Invalid backup file. Please check the file format.","error"),console.error("Restore error:",e)}},n.readAsText(o)}},e.click()}document.addEventListener("click",function(e){e.target.classList.contains("modal")&&e.target.classList.remove("active")}),setInterval(updateTrialCountdown,6e4);function toggleDarkMode(){isDarkMode=!isDarkMode,document.body.classList.toggle("dark-mode",isDarkMode),localStorage.setItem("darkMode",isDarkMode),updateToggleIcon()}function updateToggleIcon(){const e=document.querySelector(".dark-mode-toggle");e&&(e.textContent=isDarkMode?"‚òÄÔ∏è":"üåô")}"true"===localStorage.getItem("darkMode")&&(document.body.classList.add("dark-mode"),isDarkMode=!0);
    </script>
</body>
</html>
