<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Professional expense tracking PWA for owner-operator truck drivers. Track fuel, maintenance, meals, and all business expenses with receipt management and tax insights.">
    <meta name="keywords" content="trucker expenses, owner operator, truck driver, expense tracker, tax deductions, fuel tracking, maintenance records">
    <meta name="author" content="Trucker Expense Tracker">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://trucker-expense-tracker.vercel.app/">
    <meta property="og:title" content="Trucker Expense Tracker - Professional Expense Management">
    <meta property="og:description" content="Track your trucking expenses professionally with our PWA designed for owner-operators.">
    <meta property="og:image" content="https://trucker-expense-tracker.vercel.app/icon-512x512.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://trucker-expense-tracker.vercel.app/">
    <meta property="twitter:title" content="Trucker Expense Tracker - Professional Expense Management">
    <meta property="twitter:description" content="Track your trucking expenses professionally with our PWA designed for owner-operators.">
    <meta property="twitter:image" content="https://trucker-expense-tracker.vercel.app/icon-512x512.png">

    <!-- Security Headers - LIGHTHOUSE FIX: Removed X-Frame-Options meta tag, updated CSP -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: blob:; connect-src 'self'; frame-ancestors 'none';">
    <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin">

    <title>Trucker Expense Tracker - Professional Expense Management for Owner-Operators</title>
    <link rel="manifest" href="manifest.json">
    <!-- LIGHTHOUSE FIX: Updated icon references to use local files -->
    <link rel="icon" type="image/png" sizes="32x32" href="icon-192x192.png">
    <link rel="apple-touch-icon" href="icon-192x192.png">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Trucker Expense Tracker">

    <style>
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1e40af;
            --secondary-color: #10b981;
            --background-light: #f8fafc;
            --background-dark: #0f172a;
            --text-light: #1e293b;
            --text-dark: #f1f5f9;
            --card-light: #ffffff;
            --card-dark: #1e293b;
            --border-light: #e2e8f0;
            --border-dark: #334155;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --info-color: #3b82f6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: var(--text-light);
            min-height: 100vh;
            padding-bottom: 120px;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }

        body.dark-mode {
            background: linear-gradient(135deg, var(--background-dark), #0c1426);
            color: var(--text-dark);
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: calc(100vh - 120px);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            padding-top: 50px;
        }

        .header-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
            z-index: 10;
        }

        .dark-mode-toggle {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .dark-mode-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .dark-mode .dark-mode-toggle {
            background: rgba(0, 0, 0, 0.3);
            color: var(--text-dark);
        }

        .dark-mode .dark-mode-toggle:hover {
            background: rgba(0, 0, 0, 0.5);
        }

        .version-display {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .dark-mode .version-display {
            background: rgba(0, 0, 0, 0.3);
            color: var(--text-dark);
        }

        .header h1 {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .section {
            background: var(--card-light);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            /* LAYOUT SHIFT FIX: Set consistent width and prevent size changes */
            width: 100%;
            max-width: 800px;
            box-sizing: border-box;
        }

        .dark-mode .section {
            background: var(--card-dark);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .section h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .dark-mode .section h2 {
            color: var(--secondary-color);
        }

        .expense-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
            /* LAYOUT SHIFT FIX: Single column layout like original - no auto-fit */
            width: 100%;
        }

        .expense-card {
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
            border: 2px solid var(--border-light);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            /* LAYOUT SHIFT FIX: Set consistent dimensions */
            min-height: 120px;
            width: 100%;
            box-sizing: border-box;
        }

        .dark-mode .expense-card {
            background: linear-gradient(135deg, #334155, #475569);
            border-color: var(--border-dark);
        }

        .expense-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.15);
            border-color: var(--primary-color);
        }

        .expense-card.expanded {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            border-color: var(--primary-color);
        }

        .expense-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .expense-icon {
            font-size: 1.5rem;
        }

        .expense-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .expense-form {
            display: none;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .expense-card.expanded .expense-form {
            display: grid;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            padding: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.6);
            background: rgba(255, 255, 255, 0.2);
        }

        .btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            touch-action: manipulation;
            /* MOBILE FIX: Ensure buttons are always visible and accessible */
            min-height: 44px;
            /* CONTRAST FIX: Ensure sufficient contrast */
            background: #047857;
        }

        .btn:hover {
            background: #059669;
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .summary-card {
            background: linear-gradient(135deg, var(--secondary-color), #059669);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
            /* LAYOUT SHIFT FIX: Set consistent dimensions */
            width: 100%;
            max-width: 800px;
            min-height: 140px;
            box-sizing: border-box;
        }

        .summary-card h3 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .summary-item:last-child {
            margin-bottom: 0;
            font-weight: 700;
            font-size: 1.3rem;
            border-top: 1px solid rgba(255, 255, 255, 0.3);
            padding-top: 10px;
            margin-top: 10px;
        }

        .add-category-section {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
        }

        .add-category-section h3 {
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .add-category-form {
            display: grid;
            gap: 15px;
            grid-template-columns: 1fr 1fr;
        }

        .icon-picker {
            position: relative;
        }

        .icon-picker-button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            text-align: left;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .icon-picker-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .icon-list {
            display: none;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            max-height: 200px;
            overflow-y: auto;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .icon-list.active {
            display: block;
        }

        .icon-option {
            padding: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #333;
            transition: background-color 0.2s ease;
        }

        .icon-option:hover {
            background-color: #f0f0f0;
        }

        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin: 25px 0;
        }

        .action-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            touch-action: manipulation;
            /* MOBILE FIX: Ensure buttons are always visible and accessible */
            min-height: 44px;
        }

        .export-btn {
            background: #dc2626;
            color: white;
        }

        .export-btn:hover {
            background: #b91c1c;
            transform: translateY(-2px);
        }

        .print-btn {
            background: #7c3aed;
            color: white;
        }

        .print-btn:hover {
            background: #6d28d9;
            transform: translateY(-2px);
        }

        .csv-btn {
            background: #047857;
            color: white;
        }

        .csv-btn:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .feedback-btn {
            background: #c2410c;
            color: white;
        }

        .feedback-btn:hover {
            background: #ea580c;
            transform: translateY(-2px);
        }

        .faq-btn {
            background: #0369a1;
            color: white;
        }

        .faq-btn:hover {
            background: #0284c7;
            transform: translateY(-2px);
        }

        .update-btn {
            background: #7c2d12;
            color: white;
        }

        .update-btn:hover {
            background: #92400e;
            transform: translateY(-2px);
        }

        .navigation {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            padding: 15px;
            display: flex;
            justify-content: center;
            gap: 20px;
            box-shadow: 0 -4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            touch-action: manipulation;
            /* MOBILE FIX: Ensure buttons are always visible and accessible */
            min-height: 44px;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: #047857;
            color: white;
        }

        .hidden {
            display: none !important;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--card-light);
            margin: 20px;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .dark-mode .modal-content {
            background: var(--card-dark);
            color: var(--text-dark);
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-light);
            padding: 5px;
        }

        .dark-mode .modal-close {
            color: var(--text-dark);
        }

        .faq-item {
            margin-bottom: 20px;
            border: 1px solid var(--border-light);
            border-radius: 8px;
            overflow: hidden;
        }

        .dark-mode .faq-item {
            border-color: var(--border-dark);
        }

        .faq-question {
            background: var(--background-light);
            padding: 15px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dark-mode .faq-question {
            background: var(--background-dark);
        }

        .faq-answer {
            padding: 15px;
            display: none;
            border-top: 1px solid var(--border-light);
        }

        .dark-mode .faq-answer {
            border-color: var(--border-dark);
        }

        .faq-answer.active {
            display: block;
        }

        .privacy-notice {
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            border: 2px solid #d1d5db;
            border-radius: 12px;
            padding: 20px;
            margin: 25px 0;
            text-align: center;
            color: #374151;
        }

        .dark-mode .privacy-notice {
            background: linear-gradient(135deg, #374151, #4b5563);
            border-color: #6b7280;
            color: #f9fafb;
        }

        .privacy-notice h4 {
            color: #1f2937;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .dark-mode .privacy-notice h4 {
            color: #f3f4f6;
        }

        /* MOBILE FIX: Improved mobile responsiveness */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .expense-grid {
                grid-template-columns: 1fr;
            }

            .expense-form {
                grid-template-columns: 1fr;
                max-height: none;
                overflow: visible;
            }

            .add-category-form {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
                align-items: center;
                /* LAYOUT SHIFT FIX: Set consistent width */
                width: 100%;
            }

            .navigation {
                padding: 10px;
                gap: 10px;
            }

            .nav-btn {
                padding: 10px 15px;
                font-size: 12px;
            }

            body {
                padding-bottom: 100px;
            }

            /* MOBILE FIX: Ensure expense cards expand properly on mobile */
            .expense-card.expanded {
                /* Allow card to expand to full content height */
                height: auto;
                min-height: 120px; /* Maintain minimum height */
            }

            .expense-card.expanded .expense-form {
                /* Ensure form is fully visible */
                display: grid;
                grid-template-columns: 1fr;
                gap: 15px;
                margin-top: 20px;
                padding-bottom: 20px;
            }

            /* MOBILE FIX: Ensure buttons are always visible */
            .form-group .btn {
                margin-top: 10px;
                width: 100%;
                min-height: 48px;
                font-size: 16px;
            }

            /* LAYOUT SHIFT FIX: Ensure all sections maintain consistent width on mobile */
            .section,
            .summary-card,
            .add-category-section {
                width: 100%;
                max-width: none;
            }
        }

        @media print {
            body {
                background: white !important;
                color: black !important;
                padding: 0 !important;
            }

            .navigation,
            .action-buttons,
            .dark-mode-toggle,
            .version-display,
            .header-controls {
                display: none !important;
            }

            .section {
                background: white !important;
                color: black !important;
                border: 1px solid #ccc !important;
            }

            .summary-card,
            .add-category-section,
            .privacy-notice {
                background: white !important;
                color: black !important;
                border: 1px solid #ccc;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-controls">
                <button class="dark-mode-toggle" onclick="toggleDarkMode()" aria-label="Toggle dark mode">🌙</button>
                <div class="version-display">v2.1.0</div>
            </div>
            <h1>🚛 Trucker Expense Tracker</h1>
            <p class="subtitle">Professional expense management for owner-operators</p>
        </div>

        <!-- Today Section -->
        <div id="todaySection" class="section">
            <h2>📅 Log your expenses for today</h2>
            <div class="expense-grid" id="expenseGrid">
                <!-- Expense categories will be populated by JavaScript -->
            </div>

            <!-- Add New Category Section -->
            <div class="add-category-section">
                <h3>➕ Add New Category</h3>
                <div class="add-category-form">
                    <div class="form-group">
                        <label for="categoryName">Category Name</label>
                        <input type="text" id="categoryName" placeholder="Enter category name" required>
                    </div>
                    <div class="form-group">
                        <label>Icon</label>
                        <div class="icon-picker">
                            <button type="button" class="icon-picker-button" onclick="toggleIconList()">
                                <span id="selectedIconDisplay">📦 Click to choose an icon</span>
                                <span>▼</span>
                            </button>
                            <div class="icon-list" id="iconList">
                                <!-- Icons will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="defaultCostType">Default Cost Type</label>
                        <select id="defaultCostType">
                            <option value="variable">Variable Cost</option>
                            <option value="fixed">Fixed Cost</option>
                        </select>
                    </div>
                    <button type="button" class="btn" onclick="addCustomCategory()">Add Category</button>
                </div>
            </div>

            <!-- Today's Summary -->
            <div class="summary-card">
                <h3>📊 Today's Summary</h3>
                <div class="summary-item">
                    <span>Total Daily Expenses:</span>
                    <span id="dailyTotal">$0.00</span>
                </div>
                <div class="summary-item">
                    <span>Total Expenses:</span>
                    <span id="totalExpenses">$0.00</span>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="action-btn export-btn" onclick="exportToPDF()">📄 Export PDF</button>
                <button class="action-btn print-btn" onclick="printSection()">🖨️ Print</button>
                <button class="action-btn csv-btn" onclick="exportToCSV()">📊 Export CSV</button>
                <button class="action-btn feedback-btn" onclick="showFeedback()">💬 Feedback</button>
                <button class="action-btn faq-btn" onclick="showFAQ()">❓ FAQ</button>
                <button class="action-btn update-btn" onclick="checkForUpdates()">🔄 Check for Updates</button>
            </div>
        </div>

        <!-- History Section -->
        <div id="historySection" class="section hidden">
            <h2>📚 Expense History</h2>
            <div class="form-group">
                <label for="dateFilter">Filter by Date Range:</label>
                <select id="dateFilter" onchange="filterExpenses()">
                    <option value="all">All Time</option>
                    <option value="today">Today</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                    <option value="year">This Year</option>
                </select>
            </div>
            <div id="historyList">
                <p style="text-align: center; color: #666; margin: 40px 0;">No expenses recorded yet. Start by adding some expenses in the Today section!</p>
            </div>
        </div>

        <!-- Insights Section -->
        <div id="insightsSection" class="section hidden">
            <h2>📈 Insights & Analytics</h2>
            
            <div class="summary-card">
                <h3>Monthly Overview</h3>
                <div class="summary-item">
                    <span>This Month's Total:</span>
                    <span id="monthlyTotal">$0.00</span>
                </div>
                <div class="summary-item">
                    <span>Average Daily:</span>
                    <span id="averageDaily">$0.00</span>
                </div>
            </div>

            <div style="background: white; padding: 20px; border-radius: 12px; margin: 20px 0;">
                <canvas id="expenseChart" width="400" height="200"></canvas>
            </div>

            <div id="categoryBreakdown">
                <!-- Category breakdown will be populated by JavaScript -->
            </div>
        </div>

        <!-- Privacy Notice -->
        <div class="privacy-notice">
            <h4>🔒 Privacy & Data Security</h4>
            <p>Your expense data is stored locally on your device and never transmitted to external servers. All information remains private and secure on your device only.</p>
        </div>
    </div>

    <!-- Navigation -->
    <div class="navigation">
        <button class="nav-btn active" onclick="showSection('today', event)">📅 Today</button>
        <button class="nav-btn" onclick="showSection('history', event)">📚 History</button>
        <button class="nav-btn" onclick="showSection('insights', event)">📈 Insights</button>
    </div>

    <!-- Feedback Modal -->
    <div id="feedbackModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="hideFeedback()">&times;</button>
            <h3>💬 Feedback & Support</h3>
            <p>We value your feedback! Please reach out to us:</p>
            <ul style="text-align: left; margin: 20px 0;">
                <li><strong>Email:</strong> support@truckerexpensetracker.com</li>
                <li><strong>Feature Requests:</strong> Send us your ideas for new features</li>
                <li><strong>Bug Reports:</strong> Help us improve by reporting any issues</li>
                <li><strong>General Feedback:</strong> Let us know how we can make this better</li>
            </ul>
            <p>Your input helps us create a better experience for all truckers!</p>
        </div>
    </div>

    <!-- FAQ Modal -->
    <div id="faqModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="hideFAQ()">&times;</button>
            <h3>❓ Frequently Asked Questions</h3>
            <div id="faqContent">
                <!-- FAQ content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // ORIGINAL CATEGORIES - Removed lumper as requested
        const DEFAULT_CATEGORIES = [
            { id: 'fuel', name: 'Fuel', icon: '⛽', costType: 'variable' },
            { id: 'maintenance', name: 'Maintenance & Repairs', icon: '🔧', costType: 'variable' },
            { id: 'truck_payments', name: 'Truck/Trailer Payments or Lease', icon: '🚚', costType: 'fixed' },
            { id: 'insurance', name: 'Insurance Premiums', icon: '🛡️', costType: 'fixed' },
            { id: 'licensing', name: 'Licensing, Registration & Permits', icon: '📜', costType: 'fixed' },
            { id: 'tolls', name: 'Tolls & Parking Fees', icon: '🛣️', costType: 'variable' },
            { id: 'lodging', name: 'Lodging', icon: '🛏️', costType: 'variable' },
            { id: 'meals', name: 'Meals', icon: '🍽️', costType: 'variable' },
            { id: 'communication', name: 'Communication & Technology', icon: '📱', costType: 'fixed' },
            { id: 'office_supplies', name: 'Office Supplies & Subscriptions', icon: '📝', costType: 'variable' },
            { id: 'truck_supplies', name: 'Truck Supplies & Safety Gear', icon: '🧰', costType: 'variable' },
            { id: 'association_dues', name: 'Association Dues', icon: '🤝', costType: 'fixed' },
            { id: 'taxes', name: 'Taxes Paid', icon: '💸', costType: 'variable' },
            { id: 'medical', name: 'Medical Exams', icon: '🩺', costType: 'variable' }
        ];

        // Available icons for custom categories
        const AVAILABLE_ICONS = [
            { icon: '', name: 'No Icon' },
            { icon: '⛽', name: 'Fuel' },
            { icon: '🔧', name: 'Tools/Maintenance' },
            { icon: '🚚', name: 'Truck' },
            { icon: '🛡️', name: 'Shield/Insurance' },
            { icon: '📜', name: 'Document' },
            { icon: '🛣️', name: 'Road' },
            { icon: '🛏️', name: 'Bed/Lodging' },
            { icon: '🍽️', name: 'Food' },
            { icon: '📱', name: 'Phone' },
            { icon: '📝', name: 'Writing' },
            { icon: '🧰', name: 'Toolbox' },
            { icon: '🤝', name: 'Handshake' },
            { icon: '💸', name: 'Money' },
            { icon: '🩺', name: 'Medical' },
            { icon: '📦', name: 'Package' },
            { icon: '🏪', name: 'Store' },
            { icon: '⚙️', name: 'Settings' },
            { icon: '🎯', name: 'Target' },
            { icon: '📊', name: 'Chart' },
            { icon: '🔒', name: 'Security' },
            { icon: '🌟', name: 'Star' },
            { icon: '🎨', name: 'Art' },
            { icon: '🏠', name: 'Home' },
            { icon: '🔥', name: 'Fire' },
            { icon: '💡', name: 'Idea' },
            { icon: '🎵', name: 'Music' },
            { icon: '📸', name: 'Camera' },
            { icon: '🎮', name: 'Gaming' },
            { icon: '📚', name: 'Books' },
            { icon: '☕', name: 'Coffee' },
            { icon: '🍕', name: 'Fast Food' },
            { icon: '🏨', name: 'Hotel' }
        ];

        let expenses = JSON.parse(localStorage.getItem('truckerExpenses')) || [];
        let selectedIcon = '';
        let currentExpenseId = null;
        let currentSection = 'today';

        // Load user's custom categories from localStorage
        function getUserCategories() {
            const userCategories = JSON.parse(localStorage.getItem('userCustomCategories')) || [];
            return [...DEFAULT_CATEGORIES, ...userCategories];
        }

        // Save user's custom categories to localStorage
        function saveUserCategories(userCategories) {
            localStorage.setItem('userCustomCategories', JSON.stringify(userCategories));
        }

        // Initialize the application
        function initializeApp() {
            populateIconList();
            renderExpenseCategories();
            updateSummary();
            updateInsights();
            
            // Register service worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New version available
                                    if (confirm('A new version is available. Reload to update?')) {
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch(error => console.log('SW registration failed: ', error));
            }
        }

        function populateIconList() {
            const iconList = document.getElementById('iconList');
            iconList.innerHTML = '';
            
            AVAILABLE_ICONS.forEach(iconData => {
                const option = document.createElement('div');
                option.className = 'icon-option';
                option.innerHTML = `<span>${iconData.icon}</span> <span>${iconData.name}</span>`;
                option.onclick = () => selectIcon(iconData.icon, iconData.name);
                iconList.appendChild(option);
            });
        }

        function toggleIconList() {
            const iconList = document.getElementById('iconList');
            iconList.classList.toggle('active');
        }

        function selectIcon(icon, name) {
            selectedIcon = icon;
            const display = document.getElementById('selectedIconDisplay');
            display.textContent = icon ? `${icon} ${name}` : '📦 No Icon Selected';
            document.getElementById('iconList').classList.remove('active');
        }

        function renderExpenseCategories() {
            const grid = document.getElementById('expenseGrid');
            const categories = getUserCategories();
            
            grid.innerHTML = '';
            
            categories.forEach(category => {
                const card = document.createElement('div');
                card.className = 'expense-card';
                card.onclick = () => toggleExpenseForm(category.id);
                
                card.innerHTML = `
                    <div class="expense-header">
                        <div class="expense-icon">${category.icon}</div>
                        <div class="expense-title">${category.name}</div>
                    </div>
                    <div class="expense-form" id="form-${category.id}">
                        <div class="form-group">
                            <label for="amount-${category.id}">Amount ($)</label>
                            <input type="number" id="amount-${category.id}" step="0.01" placeholder="0.00" required>
                        </div>
                        <div class="form-group">
                            <label for="location-${category.id}">Location</label>
                            <input type="text" id="location-${category.id}" placeholder="Where?">
                        </div>
                        <div class="form-group full-width">
                            <label for="notes-${category.id}">Notes</label>
                            <textarea id="notes-${category.id}" placeholder="Additional details..." rows="3"></textarea>
                        </div>
                        <div class="form-group full-width">
                            <button type="button" class="btn" onclick="saveExpense('${category.id}', '${category.name}', '${category.icon}', '${category.costType}')">Save Expense</button>
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        function toggleExpenseForm(categoryId) {
            const allCards = document.querySelectorAll('.expense-card');
            const clickedCard = event.currentTarget;
            
            // Close all other forms
            allCards.forEach(card => {
                if (card !== clickedCard) {
                    card.classList.remove('expanded');
                }
            });
            
            // Toggle current form
            clickedCard.classList.toggle('expanded');
            
            // MOBILE FIX: Scroll to ensure the form is visible
            if (clickedCard.classList.contains('expanded')) {
                setTimeout(() => {
                    clickedCard.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'nearest',
                        inline: 'nearest'
                    });
                }, 100);
            }
        }

        function saveExpense(categoryId, categoryName, categoryIcon, costType) {
            const amount = parseFloat(document.getElementById(`amount-${categoryId}`).value);
            const location = document.getElementById(`location-${categoryId}`).value;
            const notes = document.getElementById(`notes-${categoryId}`).value;
            
            if (!amount || amount <= 0) {
                alert('Please enter a valid amount');
                return;
            }
            
            const expense = {
                id: Date.now(),
                category: categoryName,
                categoryIcon: categoryIcon,
                categoryId: categoryId,
                amount: amount,
                location: location,
                notes: notes,
                costType: costType,
                date: new Date().toISOString()
            };
            
            expenses.push(expense);
            localStorage.setItem('truckerExpenses', JSON.stringify(expenses));
            
            // Clear form
            document.getElementById(`amount-${categoryId}`).value = '';
            document.getElementById(`location-${categoryId}`).value = '';
            document.getElementById(`notes-${categoryId}`).value = '';
            
            // Close form
            const card = document.querySelector(`#form-${categoryId}`).closest('.expense-card');
            card.classList.remove('expanded');
            
            updateSummary();
            updateInsights();
            
            // Show success message
            showNotification(`${categoryIcon} ${categoryName} expense saved: $${amount.toFixed(2)}`);
        }

        function addCustomCategory() {
            const name = document.getElementById('categoryName').value.trim();
            const costType = document.getElementById('defaultCostType').value;
            
            if (!name) {
                alert('Please enter a category name');
                return;
            }
            
            // Check if category already exists
            const allCategories = getUserCategories();
            if (allCategories.some(cat => cat.name.toLowerCase() === name.toLowerCase())) {
                alert('A category with this name already exists');
                return;
            }
            
            const newCategory = {
                id: `custom_${Date.now()}`,
                name: name,
                icon: selectedIcon || '📦',
                costType: costType
            };
            
            // Add to user categories
            const userCategories = JSON.parse(localStorage.getItem('userCustomCategories')) || [];
            userCategories.push(newCategory);
            saveUserCategories(userCategories);
            
            // Clear form
            document.getElementById('categoryName').value = '';
            document.getElementById('selectedIconDisplay').textContent = '📦 Click to choose an icon';
            selectedIcon = '';
            
            // Refresh the expense grid
            renderExpenseCategories();
            
            showNotification(`✅ Custom category "${name}" added successfully!`);
        }

        function updateSummary() {
            const today = new Date().toDateString();
            const todayExpenses = expenses.filter(expense => 
                new Date(expense.date).toDateString() === today
            );
            
            const dailyTotal = todayExpenses.reduce((sum, expense) => sum + expense.amount, 0);
            const totalExpenses = expenses.reduce((sum, expense) => sum + expense.amount, 0);
            
            document.getElementById('dailyTotal').textContent = `$${dailyTotal.toFixed(2)}`;
            document.getElementById('totalExpenses').textContent = `$${totalExpenses.toFixed(2)}`;
        }

        function updateInsights() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            const monthlyExpenses = expenses.filter(expense => {
                const expenseDate = new Date(expense.date);
                return expenseDate.getMonth() === currentMonth && 
                       expenseDate.getFullYear() === currentYear;
            });
            
            const monthlyTotal = monthlyExpenses.reduce((sum, expense) => sum + expense.amount, 0);
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const averageDaily = monthlyTotal / daysInMonth;
            
            document.getElementById('monthlyTotal').textContent = `$${monthlyTotal.toFixed(2)}`;
            document.getElementById('averageDaily').textContent = `$${averageDaily.toFixed(2)}`;
            
            // Calculate category totals for chart
            const categoryTotals = {};
            monthlyExpenses.forEach(expense => {
                categoryTotals[expense.category] = (categoryTotals[expense.category] || 0) + expense.amount;
            });
            
            updateChart(categoryTotals);
            updateCategoryBreakdown(categoryTotals);
        }

        function updateChart(categoryTotals) {
            const ctx = document.getElementById('expenseChart').getContext('2d');
            
            // LIGHTHOUSE FIX: Destroy existing chart if it exists with proper error handling
            if (window.expenseChart) {
                try {
                    if (typeof window.expenseChart.destroy === 'function') {
                        window.expenseChart.destroy();
                    }
                } catch (error) {
                    console.warn('Error destroying chart:', error);
                }
            }
            
            const labels = Object.keys(categoryTotals);
            const data = Object.values(categoryTotals);
            
            if (labels.length === 0) {
                return;
            }
            
            window.expenseChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            '#2563eb', '#10b981', '#f59e0b', '#ef4444',
                            '#8b5cf6', '#06b6d4', '#84cc16', '#f97316',
                            '#ec4899', '#6366f1', '#14b8a6', '#eab308'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function updateCategoryBreakdown(categoryTotals) {
            const breakdown = document.getElementById('categoryBreakdown');
            const sortedCategories = Object.entries(categoryTotals)
                .sort(([,a], [,b]) => b - a);
            
            breakdown.innerHTML = `
                <h3>Category Breakdown</h3>
                ${sortedCategories.map(([category, amount]) => `
                    <div style="display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee;">
                        <span>${category}</span>
                        <strong>$${amount.toFixed(2)}</strong>
                    </div>
                `).join('')}
            `;
        }

        function showSection(section, event) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            
            // Show selected section
            document.getElementById(`${section}Section`).classList.remove('hidden');
            
            // Update navigation
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            currentSection = section;
            
            if (section === 'history') {
                loadHistory();
            } else if (section === 'insights') {
                updateInsights();
            }
        }

        function loadHistory() {
            const historyList = document.getElementById('historyList');
            const filter = document.getElementById('dateFilter').value;
            
            let filteredExpenses = [...expenses];
            const now = new Date();
            
            switch (filter) {
                case 'today':
                    filteredExpenses = expenses.filter(expense => 
                        new Date(expense.date).toDateString() === now.toDateString()
                    );
                    break;
                case 'week':
                    const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    filteredExpenses = expenses.filter(expense => 
                        new Date(expense.date) >= weekAgo
                    );
                    break;
                case 'month':
                    filteredExpenses = expenses.filter(expense => {
                        const expenseDate = new Date(expense.date);
                        return expenseDate.getMonth() === now.getMonth() && 
                               expenseDate.getFullYear() === now.getFullYear();
                    });
                    break;
                case 'year':
                    filteredExpenses = expenses.filter(expense => 
                        new Date(expense.date).getFullYear() === now.getFullYear()
                    );
                    break;
            }
            
            filteredExpenses.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            historyList.innerHTML = filteredExpenses.length > 0 ? 
                filteredExpenses.map(expense => `
                    <div style="background: white; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid var(--primary-color);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${expense.categoryIcon} ${expense.category}</strong>
                                <div style="color: #666; font-size: 0.9rem;">
                                    ${new Date(expense.date).toLocaleDateString()} ${expense.location ? `• ${expense.location}` : ''}
                                </div>
                                ${expense.notes ? `<div style="color: #888; font-size: 0.8rem; margin-top: 5px;">${expense.notes}</div>` : ''}
                            </div>
                            <div style="font-size: 1.2rem; font-weight: bold; color: var(--primary-color);">
                                $${expense.amount.toFixed(2)}
                            </div>
                        </div>
                    </div>
                `).join('') : 
                '<p style="text-align: center; color: #666; margin: 40px 0;">No expenses found for the selected period.</p>';
        }

        function filterExpenses() {
            loadHistory();
        }

        function exportToPDF() {
            const content = getSectionContent(currentSection);
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>Trucker Expense Tracker - ${currentSection.charAt(0).toUpperCase() + currentSection.slice(1)}</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            h1 { color: #2563eb; }
                            .expense-item { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
                        </style>
                    </head>
                    <body>
                        <h1>🚛 Trucker Expense Tracker - ${currentSection.charAt(0).toUpperCase() + currentSection.slice(1)}</h1>
                        ${content}
                        <p><em>Generated on ${new Date().toLocaleDateString()}</em></p>
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        function printSection() {
            exportToPDF();
        }

        function exportToCSV() {
            let dataToExport = [];
            
            if (currentSection === 'today') {
                const today = new Date().toDateString();
                dataToExport = expenses.filter(expense => 
                    new Date(expense.date).toDateString() === today
                );
            } else {
                dataToExport = expenses;
            }
            
            if (dataToExport.length === 0) {
                alert('No data to export');
                return;
            }
            
            const csvContent = [
                ['Date', 'Category', 'Amount', 'Location', 'Notes', 'Cost Type'],
                ...dataToExport.map(expense => [
                    new Date(expense.date).toLocaleDateString(),
                    expense.category,
                    expense.amount,
                    expense.location || '',
                    expense.notes || '',
                    expense.costType || 'variable'
                ])
            ].map(row => row.map(field => `"${field}"`).join(',')).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `trucker-expenses-${currentSection}-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function getSectionContent(section) {
            switch (section) {
                case 'today':
                    const today = new Date().toDateString();
                    const todayExpenses = expenses.filter(expense => 
                        new Date(expense.date).toDateString() === today
                    );
                    const todayTotal = todayExpenses.reduce((sum, expense) => sum + expense.amount, 0);
                    
                    return `
                        <h2>Today's Expenses - ${new Date().toLocaleDateString()}</h2>
                        <p><strong>Total: $${todayTotal.toFixed(2)}</strong></p>
                        ${todayExpenses.map(expense => `
                            <div class="expense-item">
                                <strong>${expense.categoryIcon} ${expense.category}</strong> - $${expense.amount.toFixed(2)}<br>
                                Location: ${expense.location || 'N/A'}<br>
                                Notes: ${expense.notes || 'N/A'}
                            </div>
                        `).join('')}
                    `;
                case 'history':
                    return `
                        <h2>Expense History</h2>
                        ${expenses.map(expense => `
                            <div class="expense-item">
                                <strong>${expense.categoryIcon} ${expense.category}</strong> - $${expense.amount.toFixed(2)}<br>
                                Date: ${new Date(expense.date).toLocaleDateString()}<br>
                                Location: ${expense.location || 'N/A'}<br>
                                Notes: ${expense.notes || 'N/A'}
                            </div>
                        `).join('')}
                    `;
                case 'insights':
                    const monthlyTotal = document.getElementById('monthlyTotal').textContent;
                    return `
                        <h2>Monthly Insights</h2>
                        <p><strong>Monthly Total: ${monthlyTotal}</strong></p>
                        <p>Detailed analytics and category breakdown available in the app.</p>
                    `;
                default:
                    return '<p>No content available</p>';
            }
        }

        function toggleDarkMode() {
            const body = document.body;
            const toggle = document.querySelector('.dark-mode-toggle');
            
            body.classList.toggle('dark-mode');
            
            if (body.classList.contains('dark-mode')) {
                toggle.textContent = '☀️';
                localStorage.setItem('theme', 'dark');
            } else {
                toggle.textContent = '🌙';
                localStorage.setItem('theme', 'light');
            }
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            const body = document.body;
            const toggle = document.querySelector('.dark-mode-toggle');
            
            if (savedTheme === 'dark') {
                body.classList.add('dark-mode');
                toggle.textContent = '☀️';
            } else {
                toggle.textContent = '🌙';
            }
        }

        function showFeedback() {
            document.getElementById('feedbackModal').classList.add('active');
        }

        function hideFeedback() {
            document.getElementById('feedbackModal').classList.remove('active');
        }

        function showFAQ() {
            populateFAQ();
            document.getElementById('faqModal').classList.add('active');
        }

        function hideFAQ() {
            document.getElementById('faqModal').classList.remove('active');
        }

        function populateFAQ() {
            const faqContent = document.getElementById('faqContent');
            const faqs = [
                {
                    question: "What is the Trucker Expense Tracker?",
                    answer: "The Trucker Expense Tracker is a Progressive Web App (PWA) designed specifically for owner-operator truck drivers to track business expenses. It works offline, can be installed on your device like a native app, and helps you organize expenses for better financial management."
                },
                {
                    question: "How do I install this app on my device?",
                    answer: "On Desktop: Look for an install icon in your browser's address bar and click it, or use the browser menu to 'Install app'. On Android: Tap the three dots menu in Chrome and select 'Add to Home Screen' or 'Install app'. On iPhone: In Safari, tap the Share button and select 'Add to Home Screen'."
                },
                {
                    question: "Is my data safe and private?",
                    answer: "Yes! All your expense data is stored locally on your device only. Nothing is transmitted to external servers or the cloud. Your information remains completely private and under your control."
                },
                {
                    question: "Can I use this app offline?",
                    answer: "Absolutely! Once installed, the app works completely offline. You can add expenses, view history, and access all features without an internet connection. This makes it perfect for use on the road."
                },
                {
                    question: "How do I add a new expense?",
                    answer: "Click on any expense category card (like Fuel, Maintenance, etc.) to expand it. Fill in the amount, location, and any notes, then click 'Save Expense'. The expense will be automatically added to your daily total and history."
                }
            ];
            
            faqContent.innerHTML = faqs.map((faq, index) => `
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQAnswer(${index})">
                        <span>${faq.question}</span>
                        <span id="faq-arrow-${index}">▼</span>
                    </div>
                    <div class="faq-answer" id="faq-answer-${index}">
                        <p>${faq.answer}</p>
                    </div>
                </div>
            `).join('');
        }

        function toggleFAQAnswer(index) {
            const answer = document.getElementById(`faq-answer-${index}`);
            const arrow = document.getElementById(`faq-arrow-${index}`);
            
            answer.classList.toggle('active');
            arrow.textContent = answer.classList.contains('active') ? '▲' : '▼';
        }

        function checkForUpdates() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistration().then(registration => {
                    if (registration) {
                        registration.update().then(() => {
                            showNotification('🔄 Checking for updates...');
                            setTimeout(() => {
                                showNotification('✅ You have the latest version!');
                            }, 2000);
                        });
                    }
                });
            } else {
                showNotification('✅ You have the latest version!');
            }
        }

        function showNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--success-color);
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 3000;
                font-weight: 600;
                max-width: 300px;
                word-wrap: break-word;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.classList.remove('active');
                }
            });
            
            // Close icon picker when clicking outside
            const iconPicker = document.querySelector('.icon-picker');
            if (!iconPicker.contains(event.target)) {
                document.getElementById('iconList').classList.remove('active');
            }
        }

        // Initialize the app when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            loadTheme();
        });
    </script>
</body>
</html>

